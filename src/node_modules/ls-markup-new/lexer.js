/*
*  A lexer implementation for the LibreSignage markup parser.
*  The token definitions are in tokens.js.
*/

var lexeme = require('./lexeme.js');
var tokens = require('./tokens.js');
var util = require('util');

module.exports.process = function(str) {
	let ret = [];
	let ln_pos = 0;
	let ln_num = 0;
	let lexeme = null;
	let lexeme_index = 0;

	lines = str.split("\n");
	for (let ln of lines) {
		while (ln_pos < ln.length) {
			for (let tm of tokens.TOKENS) {
				lexeme = tm.matcher(
					ln, ln_num, ln_pos, lexeme_index, ret
				);
				if (lexeme) {
					ln_pos += lexeme.raw.length;
					ret.push(lexeme);
					lexeme_index++;
					break;
				}
			}
			if (!lexeme) { break; }
		}
		lexeme = null;
		ln_pos = 0;
		ln_num++;
	}
	return ret;
}
