/*
*  A class for handling LibreSignage web interface popups.
*  To use this class:
*    1. Include the _popup.scss SCSS file from 'src/common/css'.
*    2. Create a div with the class 'popup' and *specify an ID for it*.
*       Add the popup content directly to this div. The Popup class will
*       automatically wrap the content with the required HTML.
*    3. Call the Popup class constructor with the assigned HTML ID
*       somewhere in you JS.
*    4. Call Popup.visible(state) where state is either true or false.
*/

var $ = require('jquery');
var assert = require('ls-assert');

const popup_content_wrapper = (id, content) => `
<div class="row popup-bar-row">
	<div id="${id}-popup-bar" class="col-12 text-right popup-bar">
		<i id="close-popup-${id}"
			class="fas fa-times-circle link-nostyle">
		</i>
	</div>
</div>
<div class="row popup-content-row">
	<div id="${id}-popup-content" class="col-12 container popup-content">
		${content}
	</div>
</div>	
`;

module.exports.Popup = class Popup {
	constructor(element, close_callback) {
		assert.assert(element);
		assert.assert(element.id);
		this.element = element;
		this.close_callback = close_callback;

		// Wrap the popup content in the wrapper HTML.
		$(this.element).html(
			popup_content_wrapper(
				this.element.id,
				this.element.innerHTML
			)
		);
		$(`#close-popup-${this.element.id}`).click(() => {
			this.visible(false);
			if (this.close_callback) { this.close_callback(); }
		});
	}

	visible(state) {
		/*
		*  Make the popup either visible or invisible
		*  depending on the value of 'state'.
		*/
		if (state) {
			$(this.element).css('display', 'flex');
		} else {
			$(this.element).css('display', 'none');
		}
	}
}
